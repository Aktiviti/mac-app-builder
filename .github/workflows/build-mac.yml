name: Build macOS .app

on: [push]  # Startet automatisch, wenn Code in das Repository hochgeladen wird

jobs:
  build:
    runs-on: macos-latest  # Nutzt GitHub's macOS-Server

    steps:
      - name: Repository auschecken
        uses: actions/checkout@v4  # Nutzt die neueste Version

      - name: Installiere Python-Abh채ngigkeiten
        run: |
          python3 -m venv venv
          source venv/bin/activate
          pip install --upgrade pip
          pip install pyinstaller
          pip install -r requirements.txt || true  # Falls requirements.txt vorhanden ist

      - name: Baue die macOS .app f체r Intel & Apple Silicon (M1/M2/M3)
        run: |
          source venv/bin/activate
          pyinstaller --onefile --windowed --target-arch universal2 \
          --hidden-import=<modulname> move_files.py  # Falls zus채tzliche Abh채ngigkeiten fehlen

      - name: Signiere die App (Gatekeeper-Fix)
        run: |
          codesign --force --deep --sign - dist/move_files.app

      - name: Erstelle .dmg-Datei
        run: |
          hdiutil create -volname "Meine App" -srcfolder dist/move_files.app -ov -format UDZO dist/move_files.dmg

      - name: Lade die .app als Download hoch
        uses: actions/upload-artifact@v4
        with:
          name: mac-app
          path: dist/move_files.app  # Die erstellte App als Download bereitstellen

      - name: Lade die .dmg als Download hoch
        uses: actions/upload-artifact@v4
        with:
          name: mac-dmg
          path: dist/move_files.dmg  # Die .dmg-Datei bereitstellen
